---
title: Дієві повідомлення
id: версія-1.0.0-дієвий
original_id: дієвий
---

Функціональні сповіщення дозволяють додавати до сповіщення 1-4 кнопки користувача. При виборі однієї з дій Home Assistant буде повідомлено, яка дія була обрана. Це дозволяє будувати складні автоматизації.

Приклади дійсних сповіщень:

* Повідомлення надсилається, коли виявляється рух у вашій оселі під час перебування або під час відпочінку. Ви можете додати дію до звукової сигналізації. Якщо натиснути, Home Assistant отримує сповіщення про те, що було вибрано дію `sound_alarm`. Ви можете додати автоматизацію, щоб пролунала охоронна сигналізація, коли сталася подія.
* Хтось дзвонить у дзвінок вхідних дверей. Ви можете надіслати дію для блокування або розблокування дверей. Після натискання, сповіщення відправляється до Home Assistant, в якому можна створювати автоматику.
* Надсилайте сповіщення, коли ваші двері гаража відчиняються з діями, щоб відчінити і зачинити гараж.

![Сповіщення дозволяють користувачу відправити команду до Home Assistant.](assets/ios/actions.png)

## Огляд роботи ефективних сповіщень

Надсилання сповіщення заздалегідь:

1. Визначте категорію сповіщень у конфігурації Home Assistant, яка містить 1-4 дії.
2. При запуску програми iOS додаток запитує категорії повідомлень від Home Assistant (також можна вручну в налаштуваннях сповіщень).

При надсиланні сповіщення:

1. Надішліть сповіщення з набором `data.push.category` для попередньо визначеного ідентифікатора категорії сповіщення.
2. Повідомлення Push доставлено на пристрій
3. Користувач відкриває сповіщення.
4. Дія натиснута
5. Ідентифікатор дії, надісланий назад у Home Assistant як властивість `actionName` події `ios.notification_action_fired`, разом з іншими метаданими, такими як ім'я пристрою та категорії.

![Як пристрій iOS і Home Assistant працює разом, щоб дозволити активні сповіщення.](assets/NotificationActionFlow.png)

## Визначення

* Категорія - категорія являє собою тип сповіщення, яке може отримати програма. Думайте про неї як про унікальну групу дій.
* Дії - дія складається з назви кнопки та інформації, яку iOS потрібно сповістити додаток після вибору дії. Для окремих дій, які підтримує ваша програма, ви створюєте окремі об'єкти дії.

## Категорія параметри

* **name** (*Обов'язково*): дружнє ім'я для цієї категорії.
* **identifier** (*Обов'язково*): унікальний ідентифікатор категорії. Має бути в нижньому регістрі й не мати спеціальних символів або пробілів.
* **actions** (*Обов'язково*): перелік дій.

## Параметри дій

* **identifier** (*Обов'язково*): унікальний ідентифікатор категорії. Має бути в верхньому регістрі та не мати спеціальних символів або пробілів. Тільки повиннен бути унікальним для категорії, не єдиним глобально.
* **title** (*Обов'язково*): текст, який буде відображатися на кнопці. Повинен бути коротким.
* **ActivationMode** (*Необов'язковий*): режим, у якому потрібно запускати програму під час виконання дії. Якщо встановити цей параметр на `foreground`, програма буде відкрита після вибору. Значення за замовчуванням - `background`.
* **authenticationRequired** (*Додатково*): якщо `true`, користувач повинен розблокувати пристрій перед виконанням дії.
* **destructive** (*Необов'язковий*): коли значення цього властивості є істинним значенням, система відображає відповідну кнопку, щоб вказати, що дія руйнівна (колір тексту червоний).
* **behavior** (*Додатково*): коли `textInput` система надає користувачеві можливість ввести текстову відповідь, яка буде включена до сповіщення. Введений текст буде надіслано до Home Assistant. Значення за замовчуванням - `default`.
* **textInputButtonTitle** (*Додатково*): мітка кнопки. *Обов'язково*, якщо `behavior` є `textInput`.
* **textInputPlaceholder** (*Необов'язковий*): текст заповнювача, який буде показано у полі введення тексту. Використовується, лише якщо `behavior` є `textInput` і пристрій працює на iOS 10.

Ось приклад повної побудованої конфігурації:

```yaml
ios:
  push:
    categories:
      - name: Alarm
        identifier: 'alarm'
        actions:
          - identifier: 'SOUND_ALARM'
            title: 'Sound Alarm'
            activationMode: 'background'
            authenticationRequired: true
            destructive: true
            behavior: 'default'
          - identifier: 'SILENCE_ALARM'
            title: 'Silence Alarm'
            activationMode: 'background'
            authenticationRequired: true
            destructive: false
            behavior: 'textInput'
            textInputButtonTitle: 'Silencio!'
            textInputPlaceholder: 'Placeholder'
```

## Побудова автоматизації для дієвіх сповіщень

Ось приклад автоматизації для надсилання повідомлення з категорією в корисному навантаженні:

```yaml
automation:
  - alias: Notify iOS app
    trigger:
      ...
    action:
      service: notify.ios_robbies_iphone_7_plus
      data:
        message: "Something happened at home!"
        data:
          push:
            badge: 5
            sound: <SOUND FILE HERE>
            category: "alarm" # Needs to match the top level identifier you used in the ios configuration
          action_data: # Anything passed in action_data will get echoed back to Home Assistant.
            entity_id: light.test
            my_custom_data: foo_bar
```

При виборі дії на шину подій Home Assistant буде випускатися подія з ім'ям `ios.notification predm_fired`. Нижче наведено приклад корисного навантаження.

```json
{
  "sourceDeviceName": "Robbie's iPhone 7 Plus",
  "sourceDeviceID": "robbies_iphone_7_plus",
  "actionName": "SOUND_ALARM",
  "sourceDevicePushId": "ab9f02fe-6ac6-47b8-adeb-5dd87b489156",
  "textInput": "",
  "actionData": {}
}
```

Ось приклад автоматизації для даного корисного навантаження:

```yaml
automation:

  - alias: Sound the alarm
    trigger:
      platform: event
      event_type: ios.notification_action_fired
      event_data:
        actionName: SOUND_ALARM
    action:
      ...
```

Примітки:

* `textInput` буде існувати лише тоді, коли для `behavior` встановлено значення `textInput`.
* `actionData` - це словник з параметрами, переданими в словнику `action_data` словника `push` у вихідному сповіщенні.
* Під час додавання або оновлення категорій push обов'язково оновлюйте налаштування push в додатку iOS програми Home Assistant. Цеможна знайти в додатку **Налаштування** (значок шестерні)> **Налаштування сповіщень**.

## Сумісність з різними пристроями

* Для пристроїв, які підтримують "Force Touch" / "3D Touch" - тривале натискання на сповіщення призведе до появи дій. Такі пристрої, як iPhone 6S, iPhone 6S Plus, iPhone 7, iPhone 7 Plus, iPhone 8, iPhone 8 Plus, iPhone X, iPhone XS, iPhone XS Max, а також деякі моделі iPad і Apple Watch.

* Для пристроїв, які не підтримують цю функцію - натискання зліва направо на сповіщення + натискання на кнопку "Перегляд" призведе до появи відповідних дій. Такі пристрої, як iPhone 6 і нижче, iPhone SE, iPhone XR як деякі моделі iPad.